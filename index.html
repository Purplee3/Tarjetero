<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creador de Tarjetas</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-storage-compat.js"></script>
</head>

<body>
  <div class="container">
    <h1>ğŸªª Creador de Tarjetas</h1>

    <div id="login">
      <button id="loginBtn">Iniciar sesiÃ³n con Google</button>
    </div>

    <div id="editor" style="display:none;">
      <h3>Bienvenido, <span id="nombreUsuario"></span> ğŸ‘‹</h3>
      <label>Nombre:</label>
      <input type="text" id="nombre" placeholder="Tu nombre completo" />

      <label>Link (YouTube o TikTok):</label>
      <input type="text" id="link" placeholder="https://tiktok.com/@usuario" />

      <label>Sube tu foto:</label>
      <input type="file" id="foto" accept="image/*" />

      <button id="guardar">Guardar Tarjeta</button>
      <p id="estado"></p>
      <div id="resultado"></div>
    </div>
  </div>

  <script>
    // ğŸ”¹ ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAMcJot3v9EBnUHHDKxmAOdamawSrUN1J0",
      authDomain: "tarjetero-8aa5e.firebaseapp.com",
      projectId: "tarjetero-8aa5e",
      storageBucket: "tarjetero-8aa5e.appspot.com",
      messagingSenderId: "1031258110983",
      appId: "1:1031258110983:web:8819d24f7b113378f17ea2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const loginBtn = document.getElementById("loginBtn");
    const editor = document.getElementById("editor");
    const loginDiv = document.getElementById("login");
    const nombreUsuario = document.getElementById("nombreUsuario");

    // ğŸ”¹ Iniciar sesiÃ³n con Google
    loginBtn.addEventListener("click", async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        const result = await auth.signInWithPopup(provider);
        const user = result.user;

        nombreUsuario.textContent = user.displayName;
        loginDiv.style.display = "none";
        editor.style.display = "block";
      } catch (error) {
        alert("Error al iniciar sesiÃ³n: " + error.message);
      }
    });

    // ğŸ”¹ Guardar tarjeta
    document.getElementById("guardar").addEventListener("click", async () => {
      const nombre = document.getElementById("nombre").value.trim();
      const link = document.getElementById("link").value.trim();
      const foto = document.getElementById("foto").files[0];
      const estado = document.getElementById("estado");

      if (!nombre || !link || !foto) {
        alert("Completa todos los campos");
        return;
      }

      try {
        estado.textContent = "ğŸ“¤ Subiendo imagen...";
        const ref = storage.ref("fotos/" + Date.now() + "_" + foto.name);
        await ref.put(foto);
        const fotoURL = await ref.getDownloadURL();

        estado.textContent = "ğŸ’¾ Guardando datos...";
        const docRef = await db.collection("tarjetas").add({
          nombre,
          link,
          fotoURL,
          fecha: new Date().toISOString()
        });

        const url = `${window.location.origin}/tarjeta.html?id=${docRef.id}`;
        estado.innerHTML = "âœ… Tarjeta guardada con Ã©xito";
        document.getElementById("resultado").innerHTML = `
          <p>Tu tarjeta estÃ¡ lista:</p>
          <a href="${url}" target="_blank">${url}</a>
        `;
      } catch (err) {
        estado.textContent = "âŒ Error: " + err.message;
      }
    });
  </script>
</body>
</html>
