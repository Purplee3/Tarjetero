<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creador de Tarjetas</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.1/firebase-storage-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      display: flex;
      justify-content: center;
      padding: 30px;
    }
    .container {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 400px;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover { background: #0056b3; }
    #resultado { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸªª Creador de Tarjetas</h1>

    <!-- LOGIN -->
    <div id="login">
      <button id="googleLogin">Iniciar con Google</button>
    </div>

    <!-- EDITOR -->
    <div id="editor" style="display:none;">
      <h2>Bienvenido, <span id="userName"></span></h2>

      <label>Nombre en la tarjeta:</label>
      <input type="text" id="nombre" placeholder="Tu nombre..." />

      <label>Red social (link):</label>
      <input type="text" id="link" placeholder="https://instagram.com/..." />

      <label>Sube tu foto:</label>
      <input type="file" id="foto" accept="image/*" />

      <button id="guardar">Guardar tarjeta</button>

      <div id="resultado"></div>
    </div>
  </div>

  <script>
    // âœ… CONFIGURA TU FIREBASE
    const firebaseConfig = {
      apiKey: "AIzaSyAMcJot3v9EBnUHHDKxmAOdamawSrUN1J0",
      authDomain: "tarjetero-8aa5e.firebaseapp.com",
      projectId: "tarjetero-8aa5e",
      storageBucket: "tarjetero-8aa5e.appspot.com",
      messagingSenderId: "1031258110983",
      appId: "1:1031258110983:web:8819d24f7b113378f17ea2"
    };

    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const googleLogin = document.getElementById("googleLogin");
    const editor = document.getElementById("editor");
    const login = document.getElementById("login");
    const userName = document.getElementById("userName");

    // ðŸ”¹ LOGIN CON GOOGLE
    googleLogin.onclick = async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        login.style.display = "none";
        editor.style.display = "block";
        userName.textContent = user.displayName;
      } catch (err) {
        alert("Error al iniciar sesiÃ³n: " + err.message);
      }
    };

    // ðŸ”¹ GUARDAR TARJETA
    document.getElementById("guardar").onclick = async () => {
      const user = auth.currentUser;
      const nombre = document.getElementById("nombre").value.trim();
      const link = document.getElementById("link").value.trim();
      const foto = document.getElementById("foto").files[0];

      if (!user) {
        alert("Primero inicia sesiÃ³n con Google.");
        return;
      }

      if (!nombre || !foto || !link) {
        alert("Completa todos los campos.");
        return;
      }

      try {
        // Subir foto al storage
        const ref = storage.ref(`fotos/${user.uid}.jpg`);
        await ref.put(foto);
        const fotoURL = await ref.getDownloadURL();

        // Guardar datos en Firestore
        await db.collection("tarjetas").doc(user.uid).set({
          nombre,
          link,
          fotoURL
        });

        // Generar URL y QR
        const url = `${window.location.origin}/tarjeta.html?id=${user.uid}`;
        const qrCanvas = document.createElement("canvas");
        QRCode.toCanvas(qrCanvas, url, { width: 150 });

        document.getElementById("resultado").innerHTML = `
          <p>âœ… Tu tarjeta estÃ¡ lista:</p>
          <a href="${url}" target="_blank">${url}</a><br><br>
        `;
        document.getElementById("resultado").appendChild(qrCanvas);
      } catch (err) {
        alert("Error al guardar tarjeta: " + err.message);
      }
    };
  </script>
</body>
</html>
