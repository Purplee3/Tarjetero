<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creador de Tarjetas</title>
  <link rel="stylesheet" href="style.css" />

  <!-- âœ… Firebase SDKs (versiÃ³n estable para compatibilidad con GitHub Pages) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

  <!-- âœ… QRCode -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
  <div class="container">
    <h1>ðŸªª Creador de Tarjetas</h1>

    <!-- LOGIN -->
    <div id="login">
      <button id="googleLogin">Iniciar sesiÃ³n con Google</button>
    </div>

    <!-- EDITOR -->
    <div id="editor" style="display:none;">
      <h2>Bienvenido, <span id="userName"></span></h2>

      <label>Nombre en la tarjeta:</label>
      <input type="text" id="nombre" placeholder="Tu nombre..." />

      <label>Link principal (ej: Instagram, YouTube o TikTok):</label>
      <input type="text" id="link" placeholder="https://..." />

      <label>Sube tu foto:</label>
      <input type="file" id="foto" accept="image/*" />

      <button id="guardar">Guardar tarjeta</button>

      <div id="resultado"></div>
    </div>
  </div>

  <!-- âœ… Tu script principal -->
  <script>
    // ðŸ”§ ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAMcJot3v9EBnUHHDKxmAOdamawSrUN1J0",
      authDomain: "tarjetero-8aa5e.firebaseapp.com",
      projectId: "tarjetero-8aa5e",
      storageBucket: "tarjetero-8aa5e.appspot.com",
      messagingSenderId: "1031258110983",
      appId: "1:1031258110983:web:8819d24f7b113378f17ea2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    const loginDiv = document.getElementById("login");
    const editorDiv = document.getElementById("editor");
    const googleLogin = document.getElementById("googleLogin");
    const userName = document.getElementById("userName");

    // ðŸ”¹ LOGIN CON GOOGLE
    googleLogin.addEventListener("click", async () => {
      try {
        const provider = new firebase.auth.GoogleAuthProvider();
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        userName.textContent = user.displayName;
        loginDiv.style.display = "none";
        editorDiv.style.display = "block";
      } catch (error) {
        alert("Error al iniciar sesiÃ³n: " + error.message);
      }
    });

    // ðŸ”¹ GUARDAR TARJETA
    document.getElementById("guardar").addEventListener("click", async () => {
      const user = auth.currentUser;
      const nombre = document.getElementById("nombre").value.trim();
      const link = document.getElementById("link").value.trim();
      const foto = document.getElementById("foto").files[0];

      if (!user) {
        alert("Primero inicia sesiÃ³n con Google.");
        return;
      }
      if (!nombre || !foto || !link) {
        alert("Completa todos los campos.");
        return;
      }

      try {
        // Subir foto al Storage
        const ref = storage.ref(fotos/${user.uid}.jpg);
        await ref.put(foto);
        const fotoURL = await ref.getDownloadURL();

        // Guardar datos en Firestore
        await db.collection("tarjetas").doc(user.uid).set({
          nombre,
          link,
          fotoURL
        });

        // Generar link y QR
        const url = ${window.location.origin}/tarjeta.html?id=${user.uid};
        const qrCanvas = document.createElement("canvas");
        QRCode.toCanvas(qrCanvas, url, { width: 150 });

        document.getElementById("resultado").innerHTML = `
          <p>âœ… Tu tarjeta estÃ¡ lista:</p>
          <a href="${url}" target="_blank">${url}</a><br><br>
        `;
        document.getElementById("resultado").appendChild(qrCanvas);
      } catch (err) {
        alert("Error al guardar tarjeta: " + err.message);
      }
    });
  </script>
</body>
</html>
